---
title: "Stats project report"
output: html_notebook
---

# Data preparation and visualization

```{r}
df <- read.csv('dataset.csv')
df$VETSTAT <- as.factor(df$VETSTAT)
df$IND <- as.factor(df$IND)
df$SCHLTYPE_revised <- as.factor(df$SCHLTYPE_revised)
head(df)
```

```{r}
# aggregating the industry variable
par(mfrow=c(1,2))
plot(df$IND)
plot(df$IND_revised)
```
We aggregated the education variable into 4 levels that capture high school, college, and advanced college degrees.
```{r}
# aggregate the education variable
df$EDUC_revised <- as.factor(sapply(df$EDUC, function(x) {
  if (x == 0) return('no school or N/A')
  else if (x < 7) return('1-12 years of pre-college')
  else if (x < 11) return('1-4 years of college')
  else return ('5+ years of college')
}))
par(mfrow=c(1,2))
plot(as.factor(df$EDUC))
plot(df$EDUC_revised)
```

Unsuprisingly, there is an obvious correlation between the education level and income.
```{r}
library(ggplot2)
ggplot(df) +
  geom_point(aes(x = seq(1,nrow(df)), y = df$INCTOT, color=df$EDUC_revised)) +
  theme_bw()
```

```{r}
# aggregate the school type variable
df$SCHLTYPE_revised <- as.factor(sapply(df$SCHLTYPE, function(x) {
  if (x == 0) return('N/A')
  else if (x == 1) return('Not Enrolled')
  else if (x == 2) return('Public School')
  else return ('Private School')
}))
par(mfrow=c(1,2))
plot(as.factor(df$SCHLTYPE))
plot(df$SCHLTYPE_revised)
```

We dropped `INCWAGE` variable after realizing it was not very discriptive. We decided to use `INCTOT` as a response variable.
```{r}
hist(df$INCTOT, breaks = 80)
```
```{r}
# save data
nrow(df)
write.csv(df, file='dataset.csv', col.names=T, row.names = F)
```

```{r}
# drop old variables
dfn <- subset(df, select = -c(MARRNO, RACE, HCOVANY, IND, VETSTAT, PWSTATE2, EDUC, SCHLTYPE))
# rename columns
colnames(dfn) <- c("WEIGHT", "NUM_CHILD", "SEX", "AGE", "WEEKS_WORKED_NUMERIC", "NUM_HOURS_WEEK", "INCOME", "TRAVEL_TIME", "INDUSTRY", "EDUC", "STATE", "SCHL_TYPE", "NUM_MARR", "RACE", "HEALTH_INS", "WEEKS_WORKED", "VETERAN")
head(dfn)
```

In the following script, we calculated the weighted (by `WEIGHT`) income for the observations with equal predictor variables.
```{r}
library(data.table)
dt <- as.data.table(dfn)
# group by predictor variables
dt <- dt[,list(INCOME=weighted.mean(INCOME, WEIGHT)), setdiff(names(dt), c("WEIGHT", "INCOME"))]
head(dt)
```
```{r}
# save new dataset
write.csv(dt, file='dataset_final.csv', col.names=T, row.names = F)
```

We still left with around 10,000 rows. 
```{r}

distributions <- function(dt) {
  par(mfrow=c(4,4))
  # show distributions of the variables
  for (i in names(dt)) {
    if (is.numeric(dt[[i]])) {
      hist(dt[[i]], main = i)
    } else {
      plot(dt[[i]], main = i)
    }
  }
}

# visualise distributions
distributions(dt)
```
The goal is to sample the dataset and maintain the distribution properties of the variable
```{r}
set.seed(1337)
dts <- dt[sample(nrow(dt), 500), ]
distributions(dts)
```
As we see, the general distribution properties are captured in the 500 observations subset.
```{r}
# save new dataset
write.csv(dts, file='dataset_final_sample.csv', col.names=T, row.names = F)
```


